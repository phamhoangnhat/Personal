<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vietnam Legal Roadmap - Fixed Version</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font 'Be Vietnam Pro' for better Vietnamese readability -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <style>
        body { 
            background-color: #0f172a; 
            color: #e2e8f0; 
            font-family: 'Be Vietnam Pro', sans-serif; 
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* Animated Background */
        .bg-glow {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: radial-gradient(circle at 50% 0%, #1e293b 0%, #0f172a 100%);
        }
        .orb {
            position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.4;
            animation: floatOrb 20s infinite alternate ease-in-out;
        }
        .orb-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: #3b82f6; animation-delay: 0s; }
        .orb-2 { bottom: -10%; right: -10%; width: 40vw; height: 40vw; background: #8b5cf6; animation-delay: -5s; }
        .orb-3 { top: 40%; left: 40%; width: 30vw; height: 30vw; background: #10b981; animation-delay: -10s; opacity: 0.2; }

        @keyframes floatOrb {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(50px, 50px) scale(1.1); }
        }

        /* Glassmorphism Card */
        .glass-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative; overflow: hidden;
        }
        .glass-card::before {
            content: ''; position: absolute; inset: 0;
            background: linear-gradient(125deg, rgba(255,255,255,0.1) 0%, transparent 40%, transparent 60%, rgba(255,255,255,0.05) 100%);
            opacity: 0; transition: opacity 0.4s;
        }
        .glass-card:hover {
            transform: translateY(-5px) scale(1.01);
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.5);
        }
        .glass-card:hover::before { opacity: 1; }

        /* Neon Glow Effects */
        .glow-text { text-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }
        
        .border-glow-blue:hover { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3), inset 0 0 10px rgba(59, 130, 246, 0.1); border-color: rgba(59, 130, 246, 0.5); }
        .border-glow-indigo:hover { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3), inset 0 0 10px rgba(99, 102, 241, 0.1); border-color: rgba(99, 102, 241, 0.5); }
        .border-glow-emerald:hover { box-shadow: 0 0 20px rgba(16, 185, 129, 0.3), inset 0 0 10px rgba(16, 185, 129, 0.1); border-color: rgba(16, 185, 129, 0.5); }

        /* Timeline Connector */
        .timeline-spine {
            position: absolute; left: 24px; top: 0; bottom: 0; width: 2px;
            background: linear-gradient(to bottom, rgba(148, 163, 184, 0.1), rgba(148, 163, 184, 0.5));
            z-index: 0;
        }
        .last-item .timeline-spine { bottom: 50%; background: linear-gradient(to bottom, rgba(148, 163, 184, 0.5), transparent); }

        .timeline-node {
            position: absolute; left: 19px; top: 28px;
            width: 12px; height: 12px; border-radius: 50%;
            background: #0f172a; border: 2px solid #64748b;
            z-index: 10; transition: all 0.4s;
            box-shadow: 0 0 0 4px rgba(15, 23, 42, 1);
        }
        .glass-card:hover ~ .timeline-node {
            border-color: #3b82f6; background: #3b82f6;
            box-shadow: 0 0 15px #3b82f6, 0 0 0 4px rgba(15, 23, 42, 1);
        }

        /* Modal */
        .modal-enter { opacity: 0; transform: scale(0.95) translateY(20px); filter: blur(10px); }
        .modal-enter-active { opacity: 1; transform: scale(1) translateY(0); filter: blur(0); transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div class="bg-glow">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
    </div>

    <!-- Header -->
    <header class="fixed top-0 left-0 w-full z-50 bg-[#0f172a]/80 backdrop-blur-md border-b border-white/5 transition-all duration-300" id="main-header">
        <div class="max-w-5xl mx-auto px-6 h-20 flex items-center justify-between">
            <div class="flex items-center gap-4 group cursor-pointer">
                <div class="relative w-12 h-12 flex items-center justify-center">
                    <div class="absolute inset-0 bg-blue-500 rounded-xl blur opacity-40 group-hover:opacity-60 transition-opacity"></div>
                    <div class="relative w-full h-full bg-slate-800 rounded-xl border border-white/10 flex items-center justify-center text-white font-bold text-lg">VN</div>
                </div>
                <div>
                    <h1 class="font-bold text-xl text-white tracking-wide glow-text">LEGAL ROADMAP</h1>
                    <p class="text-xs text-blue-300 font-medium tracking-widest uppercase">Premium Edition 2025</p>
                </div>
            </div>
            
            <div class="hidden sm:flex gap-4">
                <div class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-blue-500/10 border border-blue-500/20 text-xs font-semibold text-blue-300">
                    <span class="w-1.5 h-1.5 rounded-full bg-blue-400 shadow-[0_0_5px_#60a5fa]"></span> Bắt buộc
                </div>
                <div class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-orange-500/10 border border-orange-500/20 text-xs font-semibold text-orange-300">
                    <span class="w-1.5 h-1.5 rounded-full bg-orange-400 shadow-[0_0_5px_#fb923c]"></span> Có điều kiện
                </div>
            </div>
        </div>
    </header>

    <main class="flex-1 max-w-5xl mx-auto px-6 pt-32 pb-20 w-full relative z-10">
        
        <!-- Intro -->
        <div class="text-center mb-16">
            <!-- FIX APPLIED HERE: Changed 'leading-tight' to 'leading-normal' and added 'py-2' -->
            <h2 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400 mb-6 tracking-tight gs-title leading-normal py-2">
                LỘ TRÌNH PHÁP LÝ DỰ ÁN
            </h2>
            <p class="text-slate-300 text-sm md:text-base max-w-2xl mx-auto leading-relaxed gs-subtitle font-normal">
                Hệ thống hóa quy trình pháp lý xây dựng tại Việt Nam theo tiêu chuẩn mới nhất. 
                Trực quan hóa các bước thực hiện, hồ sơ cần thiết và kết quả đầu ra.
            </p>
        </div>

        <!-- TIMELINE FLOW -->
        <div id="roadmap-root" class="space-y-0 relative pl-4 md:pl-0">
            <!-- Content injected via JS -->
        </div>

    </main>

    <!-- PREMIUM MODAL -->
    <div id="modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4 sm:p-6">
        <div class="absolute inset-0 bg-[#000]/80 backdrop-blur-md transition-opacity duration-500" onclick="closeModal()"></div>
        <div class="glass-card w-full max-w-5xl h-[85vh] relative z-10 flex flex-col modal-enter-active bg-[#1e293b]/95 border-white/10 !rounded-3xl">
            
            <!-- Modal Header -->
            <div class="px-8 py-6 border-b border-white/5 flex justify-between items-start bg-white/5 sticky top-0 z-20 backdrop-blur-xl">
                <div>
                    <div class="flex items-center gap-3 mb-2">
                        <span id="m-id" class="px-3 py-1 rounded-lg text-[10px] font-bold uppercase tracking-widest bg-blue-500/20 text-blue-300 border border-blue-500/30 shadow-[0_0_10px_rgba(59,130,246,0.2)]">ID</span>
                        <span class="w-1 h-1 rounded-full bg-slate-500"></span>
                        <span id="m-stage" class="text-xs font-bold text-slate-400 uppercase tracking-wide">Giai đoạn</span>
                    </div>
                    <h2 id="m-title" class="text-3xl font-bold text-white leading-tight">Title</h2>
                </div>
                <button onclick="closeModal()" class="w-10 h-10 flex items-center justify-center rounded-full bg-white/5 text-slate-400 hover:bg-white/10 hover:text-white transition-all hover:rotate-90 duration-300 border border-white/5">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <!-- Modal Content -->
            <div class="flex-1 overflow-y-auto p-8 grid grid-cols-1 lg:grid-cols-3 gap-10 custom-scroll">
                
                <!-- Left Column -->
                <div class="lg:col-span-2 space-y-10">
                    <!-- Overview -->
                    <div class="gs-modal-reveal">
                        <h4 class="font-bold text-blue-400 text-sm uppercase tracking-widest mb-4 flex items-center gap-3">
                            <span class="w-8 h-[1px] bg-blue-500/50"></span> Tổng Quan
                        </h4>
                        <p id="m-desc" class="text-slate-200 leading-relaxed text-lg font-normal text-justify"></p>
                        
                        <div class="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="bg-white/5 p-5 rounded-2xl border border-white/5 hover:bg-white/10 transition-colors">
                                <div class="text-[10px] font-bold text-slate-500 uppercase mb-2 tracking-wider">Căn cứ pháp lý</div>
                                <div id="m-legal" class="text-sm font-semibold text-blue-300"></div>
                            </div>
                            <div class="bg-white/5 p-5 rounded-2xl border border-white/5 hover:bg-white/10 transition-colors">
                                <div class="text-[10px] font-bold text-slate-500 uppercase mb-2 tracking-wider">Cơ quan thụ lý</div>
                                <div id="m-agency" class="text-sm font-semibold text-slate-200"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Steps Timeline -->
                    <div class="gs-modal-reveal">
                        <h4 class="font-bold text-slate-400 text-sm uppercase tracking-widest mb-6 flex items-center gap-3">
                            <span class="w-8 h-[1px] bg-slate-500/50"></span> Quy trình
                        </h4>
                        <div id="m-steps" class="space-y-0 relative border-l border-white/10 ml-3 pl-8 pb-4"></div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="space-y-6">
                    <!-- Output Box -->
                    <div class="bg-gradient-to-br from-emerald-500/20 to-emerald-900/20 border border-emerald-500/30 p-6 rounded-2xl shadow-[0_0_30px_rgba(16,185,129,0.1)] relative overflow-hidden group hover:scale-[1.02] transition-transform duration-500 gs-modal-reveal">
                        <div class="absolute -right-4 -top-4 w-24 h-24 bg-emerald-500/20 rounded-full blur-2xl group-hover:bg-emerald-500/30 transition-colors"></div>
                        <h4 class="text-xs font-bold text-emerald-400 uppercase mb-4 flex items-center gap-2 relative z-10 tracking-wider">
                            <span class="w-2 h-2 bg-emerald-400 rounded-full shadow-[0_0_8px_#34d399]"></span> Kết quả đầu ra
                        </h4>
                        <ul id="m-outputs" class="text-sm font-bold text-emerald-200 space-y-3 relative z-10"></ul>
                    </div>

                    <!-- Input Docs -->
                    <div class="bg-white/5 border border-white/10 p-6 rounded-2xl hover:bg-white/10 transition-colors gs-modal-reveal">
                        <h4 class="text-xs font-bold text-slate-400 uppercase mb-4 flex items-center gap-2 tracking-wider">
                            <span class="w-2 h-2 bg-slate-400 rounded-full"></span> Hồ sơ đầu vào
                        </h4>
                        <ul id="m-docs" class="space-y-3"></ul>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        gsap.registerPlugin(ScrollTrigger);

        // --- DATA SOURCE ---
        const legalData = [
            {
                phase: "Giai đoạn 1: Chuẩn bị đầu tư",
                color: "text-blue-400", border: "border-blue-500/30",
                tasks: [
                    {
                        id: "1.1", title: "Chấp thuận chủ trương đầu tư",
                        isConditional: true,
                        desc: "Thủ tục pháp lý đầu tiên xác lập quyền đầu tư. Áp dụng với dự án nhà ở, KĐT, dự án vốn lớn theo Luật Đầu tư 2020.",
                        legal: "Luật Đầu tư 2020 (Điều 30-32)", agency: "Sở KHĐT / UBND Tỉnh",
                        steps: ["Nộp hồ sơ đề xuất dự án.", "Lấy ý kiến thẩm định các Sở.", "Ra Quyết định chấp thuận."],
                        docs: ["Văn bản đề nghị thực hiện dự án.", "Hồ sơ năng lực tài chính.", "Đề xuất dự án."],
                        outputs: ["Quyết định Chấp thuận chủ trương đầu tư."]
                    },
                    {
                        id: "1.2", title: "Quy hoạch chi tiết 1/500",
                        isConditional: true,
                        desc: "Xác định chỉ tiêu kiến trúc (Mật độ, tầng cao). Dự án nhỏ (<5ha) có thể lập Tổng mặt bằng (TMB) thay thế.",
                        legal: "Luật Quy hoạch đô thị 2009", agency: "Sở QHKT",
                        steps: ["Khảo sát địa hình.", "Lập đồ án.", "Lấy ý kiến dân cư.", "Phê duyệt."],
                        docs: ["Bản đồ địa hình.", {t: "Quyết định Chủ trương đầu tư", ref: "1.1"}, "Thuyết minh QH."],
                        outputs: ["Quyết định Phê duyệt QH 1/500."]
                    }
                ]
            },
            {
                phase: "Giai đoạn 2: Lập Dự án (Thiết kế cơ sở)",
                color: "text-indigo-400", border: "border-indigo-500/30",
                tasks: [
                    {
                        id: "2.1", title: "Thẩm duyệt PCCC (Cơ sở)",
                        isConditional: true, tag: "Song song",
                        desc: "Thẩm duyệt giải pháp an toàn cháy. Điều kiện tiên quyết để được thẩm định dự án tại Sở Xây dựng.",
                        legal: "NĐ 136/2020, NĐ 50/2024", agency: "Phòng PC07",
                        steps: ["Lập hồ sơ thiết kế.", "Nộp CA PCCC.", "Thẩm duyệt."],
                        docs: [{t: "QĐ Quy hoạch 1/500", ref: "1.2"}, "Hồ sơ thiết kế PCCC."],
                        outputs: ["Văn bản thẩm duyệt thiết kế PCCC."]
                    },
                    {
                        id: "2.2", title: "Thẩm định ĐTM (Môi trường)",
                        isConditional: true, tag: "Song song",
                        desc: "Đánh giá tác động môi trường. Phải hoàn thành trước khi phê duyệt dự án.",
                        legal: "Luật BVMT 2020", agency: "Sở TNMT",
                        steps: ["Quan trắc hiện trường.", "Tham vấn cộng đồng.", "Thẩm định."],
                        docs: [{t: "Quyết định Chủ trương", ref: "1.1"}, "Báo cáo ĐTM."],
                        outputs: ["Quyết định phê duyệt ĐTM."]
                    },
                    {
                        id: "2.3", title: "Thẩm tra TKCS (Độc lập)",
                        tag: "Kiểm soát",
                        desc: "Tư vấn độc lập do CĐT thuê để rà soát thiết kế trước khi nộp Sở XD. Giúp giảm thiểu sai sót kỹ thuật và rủi ro.",
                        legal: "NĐ 15/2021", agency: "Đơn vị Thẩm tra",
                        steps: ["Gửi hồ sơ.", "Rà soát tiêu chuẩn.", "Báo cáo lỗi.", "Xác nhận đạt."],
                        docs: ["Hồ sơ TKCS (của TVTK)."],
                        outputs: ["Báo cáo kết quả Thẩm tra TKCS."]
                    },
                    {
                        id: "2.4", title: "Thẩm định Báo cáo NCKT",
                        isMerge: true,
                        desc: "Giai đoạn then chốt. Sở Xây dựng thẩm định sự phù hợp của các hồ sơ thành phần (PCCC, Môi trường, Thẩm tra).",
                        legal: "NĐ 15/2021, NĐ 35/2023", agency: "Sở XD (Thẩm định)",
                        steps: ["Nộp hồ sơ tổng hợp.", "Rà soát pháp lý.", "Thông báo KQ."],
                        docs: ["Tờ trình.", "Hồ sơ TKCS.", {t: "Báo cáo Thẩm tra", ref: "2.3"}, {t: "Văn bản PCCC", ref: "2.1"}, {t: "QĐ ĐTM", ref: "2.2"}],
                        outputs: ["Thông báo kết quả thẩm định Báo cáo NCKT."]
                    },
                    {
                        id: "2.5", title: "Phê duyệt Dự án Đầu tư",
                        desc: "CĐT ra Quyết định phê duyệt dự án sau khi có kết quả thẩm định của Sở Xây dựng.",
                        legal: "Luật XD 2014 (Điều 60)", agency: "Chủ đầu tư",
                        steps: ["Lập tờ trình.", "Ký Quyết định."],
                        docs: [{t: "Thông báo KQ thẩm định Sở XD", ref: "2.4"}],
                        outputs: ["Quyết định Phê duyệt Dự án Đầu tư."]
                    }
                ]
            },
            {
                phase: "Giai đoạn 3: Thiết kế Thi công & GPXD",
                color: "text-emerald-400", border: "border-emerald-500/30",
                tasks: [
                    {
                        id: "3.1", title: "Thiết kế BVTC & Thẩm tra",
                        desc: "Triển khai chi tiết để thi công. CĐT tổ chức thẩm định và phê duyệt bước này (sau khi có Báo cáo thẩm tra độc lập).",
                        legal: "NĐ 15/2021 (Điều 35)", agency: "Chủ đầu tư",
                        steps: ["Thiết kế chi tiết.", "Thẩm tra.", "CĐT phê duyệt."],
                        docs: ["Hồ sơ TKBVTC.", "Báo cáo thẩm tra TKBVTC."],
                        outputs: ["Quyết định phê duyệt Thiết kế bản vẽ thi công."]
                    },
                    {
                        id: "3.2", title: "Cấp Giấy phép Xây dựng",
                        desc: "Thủ tục hành chính cuối cùng. Lưu ý các trường hợp MIỄN GPXD (Dự án KĐT có QH 1/500, đã thẩm định TKCS...).",
                        legal: "Luật Xây dựng 2014 (Điều 89-102)", agency: "Sở Xây dựng",
                        steps: ["Nộp hồ sơ.", "Kiểm tra thực địa.", "Cấp Giấy phép."],
                        docs: [
                            "Đơn đề nghị.", "Giấy tờ đất.", 
                            {t: "QĐ Phê duyệt dự án", ref: "2.5"}, 
                            {t: "QĐ Phê duyệt TKBVTC", ref: "3.1"},
                            {t: "Văn bản PCCC", ref: "2.1"}
                        ],
                        outputs: ["Giấy phép Xây dựng (kèm bản vẽ đóng dấu)."]
                    }
                ]
            }
        ];

        // --- RENDER LOGIC ---
        function render() {
            const root = document.getElementById('roadmap-root');
            
            // Header Animation
            gsap.from("#main-header", { y: -100, opacity: 0, duration: 1.2, ease: "power3.out" });
            gsap.from(".gs-title", { y: 30, opacity: 0, duration: 1, delay: 0.3, ease: "power3.out" });
            gsap.from(".gs-subtitle", { y: 20, opacity: 0, duration: 1, delay: 0.5, ease: "power3.out" });

            legalData.forEach((p, index) => {
                const isLastP = index === legalData.length - 1;
                
                const phaseContainer = document.createElement('div');
                phaseContainer.className = "mb-20";
                
                // Render Phase Title
                phaseContainer.innerHTML = `
                    <div class="relative z-10 flex items-center gap-6 mb-10 pl-2 reveal-phase">
                        <div class="relative">
                            <span class="absolute inset-0 ${p.color.replace('text-', 'bg-')} blur-xl opacity-20 rounded-full"></span>
                            <span class="relative bg-[#0f172a] ${p.color} font-bold uppercase text-xs tracking-[0.2em] px-6 py-3 rounded-full border border-white/10 shadow-lg">
                                ${p.phase}
                            </span>
                        </div>
                        <div class="h-px bg-gradient-to-r from-white/10 to-transparent flex-1"></div>
                    </div>
                    <div class="timeline-container relative">
                        ${!isLastP ? '<div class="timeline-spine"></div>' : '<div class="timeline-spine"></div>'}
                        <div class="tasks-wrapper"></div>
                    </div>
                `;
                
                const tasksWrapper = phaseContainer.querySelector('.tasks-wrapper');
                
                p.tasks.forEach((t, i) => {
                    const isLast = i === p.tasks.length - 1;
                    const badge = t.isConditional 
                        ? `<span class="text-[9px] font-bold text-orange-300 bg-orange-500/10 border border-orange-500/20 px-3 py-1 rounded-full backdrop-blur-md">Có điều kiện</span>` 
                        : `<span class="text-[9px] font-bold text-blue-300 bg-blue-500/10 border border-blue-500/20 px-3 py-1 rounded-full backdrop-blur-md">Bắt buộc</span>`;
                    
                    const tag = t.tag ? `<span class="text-[9px] font-bold text-slate-400 bg-white/5 px-3 py-1 rounded-full ml-2 border border-white/5">${t.tag}</span>` : '';
                    
                    // Card Border Color Logic
                    let glowClass = "border-glow-blue";
                    if (p.phase.includes("Giai đoạn 2")) glowClass = "border-glow-indigo";
                    if (p.phase.includes("Giai đoạn 3")) glowClass = "border-glow-emerald";
                    if (t.isMerge) glowClass = "border-l-4 border-l-emerald-500 bg-gradient-to-r from-emerald-900/10 to-transparent";

                    const taskHtml = document.createElement('div');
                    taskHtml.className = `relative mb-8 ${isLast ? 'last-item' : ''} task-item-reveal`;
                    taskHtml.innerHTML = `
                        <div class="timeline-node"></div>
                        <div onclick="openModal('${t.id}')" class="glass-card p-7 cursor-pointer ${glowClass} ${mergeStyle = t.isMerge ? 'border-emerald-500/30' : ''} group">
                            <div class="flex justify-between items-start mb-4">
                                <div class="flex items-center gap-4">
                                    <span class="text-xs font-mono font-bold text-slate-500 group-hover:text-white transition-colors bg-black/20 px-2 py-1 rounded border border-white/5">${t.id}</span>
                                    <h3 class="font-bold text-slate-200 text-xl group-hover:text-white transition-colors">${t.title}</h3>
                                </div>
                                <div class="flex gap-1">${badge}${tag}</div>
                            </div>
                            <p class="text-sm text-slate-400 leading-relaxed mb-0 pl-0 sm:pl-12 font-medium group-hover:text-slate-300 transition-colors">${t.desc}</p>
                            
                            <div class="absolute right-6 bottom-6 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-x-4 group-hover:translate-x-0">
                                <div class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center text-white backdrop-blur-sm border border-white/10">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>
                                </div>
                            </div>
                        </div>
                    `;
                    tasksWrapper.appendChild(taskHtml);
                });

                root.appendChild(phaseContainer);
            });

            // GSAP Animations
            gsap.utils.toArray('.reveal-phase').forEach(item => {
                gsap.from(item, {
                    opacity: 0, x: -20, duration: 0.8, ease: "power2.out",
                    scrollTrigger: { trigger: item, start: "top 85%" }
                });
            });

            gsap.utils.toArray('.task-item-reveal').forEach((item, i) => {
                gsap.from(item, {
                    opacity: 0, y: 30, duration: 0.6, ease: "back.out(1.2)",
                    scrollTrigger: { trigger: item, start: "top 90%" }
                });
            });

        }

        // --- MODAL LOGIC ---
        function findTask(id) {
            for(let p of legalData) {
                for(let t of p.tasks) {
                    if(t.id === id) return { ...t, phaseTitle: p.phase };
                }
            }
            return null;
        }

        function openModal(id) {
            const d = findTask(id);
            if(!d) return;

            document.getElementById('m-id').innerText = d.id;
            document.getElementById('m-stage').innerText = d.phaseTitle;
            document.getElementById('m-title').innerText = d.title;
            document.getElementById('m-desc').innerText = d.desc;
            document.getElementById('m-legal').innerText = d.legal;
            document.getElementById('m-agency').innerText = d.agency;

            document.getElementById('m-steps').innerHTML = d.steps.map((s,i) => `
                <div class="flex gap-5 pb-6 last:pb-0 relative group">
                    <div class="absolute left-[14px] top-3 bottom-0 w-[1px] bg-white/10 last:hidden group-last:hidden"></div>
                    <div class="w-8 h-8 rounded-xl bg-blue-500/10 text-blue-400 flex items-center justify-center text-sm font-bold flex-none z-10 shadow-lg border border-blue-500/20 group-hover:bg-blue-500 group-hover:text-white transition-all duration-300 shadow-blue-900/20">${i+1}</div>
                    <p class="text-sm text-slate-300 pt-1.5 font-medium leading-relaxed group-hover:text-white transition-colors">${s}</p>
                </div>
            `).join('');

            document.getElementById('m-docs').innerHTML = d.docs.map(doc => {
                const text = typeof doc === 'string' ? doc : doc.t;
                const ref = (typeof doc === 'object' && doc.ref) ? `<span onclick="openModal('${doc.ref}')" class="ml-2 inline-flex items-center rounded-lg bg-indigo-500/20 px-2 py-1 text-[10px] font-bold text-indigo-300 cursor-pointer hover:bg-indigo-500/40 border border-indigo-500/30 transition-all hover:scale-105" title="Xem nguồn">⬅ ${doc.ref}</span>` : '';
                return `
                <li class="flex items-start gap-3 p-3 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 hover:border-white/10 transition-all duration-300 group">
                    <div class="w-2 h-2 rounded-full bg-amber-400 mt-2 flex-none shadow-[0_0_8px_#fbbf24] group-hover:scale-125 transition-transform"></div>
                    <span class="text-sm text-slate-400 group-hover:text-slate-200 font-medium leading-snug transition-colors">${text} ${ref}</span>
                </li>`;
            }).join('');

            document.getElementById('m-outputs').innerHTML = d.outputs.map(o => `
                <li class="flex items-center gap-3 group">
                    <div class="w-6 h-6 rounded-full bg-emerald-500/20 flex items-center justify-center flex-none group-hover:bg-emerald-500/40 transition-colors border border-emerald-500/20">
                        <svg class="w-3.5 h-3.5 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/></svg>
                    </div>
                    <span class="text-emerald-200 group-hover:text-white transition-colors text-sm">${o}</span>
                </li>
            `).join('');

            const modal = document.getElementById('modal');
            modal.classList.remove('hidden');
            
            // Modal Animation
            gsap.fromTo(".modal-enter-active", 
                { scale: 0.9, opacity: 0, y: 50, filter: "blur(10px)" }, 
                { scale: 1, opacity: 1, y: 0, filter: "blur(0px)", duration: 0.5, ease: "expo.out" }
            );
            
            // Stagger Content
            gsap.fromTo(".gs-modal-reveal",
                { y: 30, opacity: 0 },
                { y: 0, opacity: 1, duration: 0.5, stagger: 0.1, delay: 0.2, ease: "power2.out" }
            );

            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            gsap.to(".modal-enter-active", { 
                scale: 0.95, opacity: 0, y: 20, filter: "blur(10px)", duration: 0.3, ease: "power2.in", 
                onComplete: () => {
                    modal.classList.add('hidden');
                    document.body.style.overflow = 'auto';
                }
            });
        }

        document.getElementById('modal').addEventListener('click', (e) => {
            if(e.target === document.getElementById('modal') || e.target.closest('.absolute')) closeModal();
        });

        // Initialize
        window.onload = render;
    </script>
</body>
</html>